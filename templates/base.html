{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% block titulo %}DOCIA{% endblock %}</title>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/bootstrap-icons.css' %}">
  <link rel="stylesheet" href="{% static 'css/docia.css' %}">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">

  {% block extra_css %}{% endblock %}
</head>

<body class="docia-body">

<header class="docia-header">

  <!-- Fila superior: logo + menú (desktop) / logo centrado (mobile) -->
  <div class="container">
    <div class="d-flex align-items-center justify-content-between flex-column flex-lg-row">

      <!-- Logo -->
      <div class="docia-brand text-center text-lg-start mb-2 mb-lg-0">
        <img src="{% static 'logo.svg' %}"
             alt="DOCIA"
             class="docia-logo">
        <div class="docia-brand-text">
          <span class="docia-subtitle">Gestión y consulta documental</span>
        </div>
      </div>

      <!-- Navegación -->
      <nav class="docia-nav d-flex align-items-center gap-4">

        <a href="{% url 'documentos' %}"
           class="docia-link docia-nav-item {% if request.resolver_match.url_name == 'documentos' %}active{% endif %}"
           data-bs-toggle="tooltip"
           data-bs-placement="bottom"
           title="Documentos">
          <i class="bi bi-file-earmark-text"></i>
          <span>Documentos</span>
        </a>

        <a href="{% url 'preguntar_argos_link' %}"
           class="docia-link docia-nav-item {% if request.resolver_match.url_name == 'preguntar_argos_link' %}active{% endif %}"
           data-bs-toggle="tooltip"
           data-bs-placement="bottom"
           title="Consulta IA">
          <i class="bi bi-chat-dots"></i>
          <span>Consulta IA</span>
        </a>

        <!-- Usuario -->
        <div class="dropdown">
          <a href="#"
             class="docia-link docia-nav-item dropdown-toggle"
             data-bs-toggle="dropdown"
             aria-expanded="false"
             title="Usuario">
            <i class="bi bi-person-circle"></i>
            <span>{{ user.username }}</span>
          </a>

          <ul class="dropdown-menu dropdown-menu-end" style="z-index: 1222;">
            <li>
              <a class="dropdown-item" href="/perfil">
                <i class="bi bi-person me-2"></i> Mi perfil
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item text-danger" href="{% url 'salir' %}">
                <i class="bi bi-box-arrow-right me-2"></i> Salir
              </a>
            </li>
          </ul>
        </div>

      </nav>
    </div>
  </div>


</header>

<main class="docia-main container">

<div id="overlay-cargando" class="overlay-cargando">
  <div class="overlay-contenido">
    <div class="spinner-border text-primary mb-3" role="status"></div>
    <p class="mb-0">Procesando documento PDF…</p>
    <small class="text-muted">Esta operación puede demorar unos segundos</small>
  </div>
</div>
 

  {% if messages %}
    {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  {% block contenido %}{% endblock %}

</main>

<footer class="docia-footer">
  <small>DOCIA · Sistema de consulta documental</small>
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Tooltips -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const tooltipTriggerList = [].slice.call(
    document.querySelectorAll('[data-bs-toggle="tooltip"]')
  )
  tooltipTriggerList.map(el => new bootstrap.Tooltip(el))
})
</script>

<script>
function mostrarOverlay() {
  document.getElementById("overlay-cargando").classList.add("activo");
}

function ocultarOverlay() {
  document.getElementById("overlay-cargando").classList.remove("activo");
}

document.querySelectorAll("form").forEach(form => {
  form.addEventListener("submit", function (e) {

    mostrarOverlay();

    // Si NO es AJAX → dejamos que el submit normal continúe
    if (!this.dataset.ajax) {
      return;
    }

    // Si ES AJAX → lo manejamos nosotros
    e.preventDefault();

    const formData = new FormData(this);

    fetch(this.action, {
      method: this.method || "POST",
      body: formData,
      headers: {
        "X-Requested-With": "XMLHttpRequest"
      }
    })
    .then(resp => resp.json())
    .then(data => {
      if (data.ok) {
        // acciones post-OK
      } else {
        alert(data.error || "Error");
      }
    })
    .catch(() => {
      
    })
    .finally(() => {
      ocultarOverlay();
    });
  });
});
</script>


{% block extra_js %}{% endblock %}

</body>
</html>
